<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domestic Violence Classes Enrollment - Aspire Impact Network</title>
    <meta name="description" content="Enroll in evidence-based domestic violence accountability classes. Court-referred or voluntary enrollment available in Geneva, Nebraska.">
    <meta name="keywords" content="domestic violence classes, DV classes, accountability program, court-referred, Geneva Nebraska, batterer intervention">
    <meta name="author" content="Aspire Impact Network">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://aspireimpactnetwork.com/dv-classes-enrollment.html">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://aspireimpactnetwork.com/dv-classes-enrollment.html">
    <meta property="og:title" content="Domestic Violence Classes Enrollment - Aspire Impact Network">
    <meta property="og:description" content="Enroll in evidence-based domestic violence accountability classes. Court-referred or voluntary enrollment available.">
    <meta property="og:site_name" content="Aspire Impact Network">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://aspireimpactnetwork.com/dv-classes-enrollment.html">
    <meta name="twitter:title" content="Domestic Violence Classes Enrollment - Aspire Impact Network">
    <meta name="twitter:description" content="Enroll in evidence-based domestic violence accountability classes. Court-referred or voluntary enrollment available.">
    
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="nav-container">
                <div class="nav-logo">
                    <h2>Aspire Impact Network</h2>
                </div>
                <ul class="nav-menu">
                    <li><a href="index.html" class="nav-link">Home</a></li>
                    <li><a href="justice-support.html" class="nav-link active">Justice Support</a></li>
                    <li><a href="digital-solutions.html" class="nav-link">Digital Solutions</a></li>
                    <li><a href="membership.html" class="nav-link">Membership</a></li>
                    <li><a href="contact.html" class="nav-link">Contact</a></li>
                </ul>
                <div class="nav-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <!-- Page Header -->
        <section class="page-header">
            <div class="container">
                <div class="page-header-content">
                    <h1>Domestic Violence Classes Enrollment</h1>
                    <p>Evidence-based accountability program designed to promote healthy relationships and prevent future violence.</p>
                </div>
            </div>
        </section>

        <!-- Quick Link for Current Students -->
        <section style="padding: 1.5rem 0; background: rgba(0, 255, 65, 0.08); border-bottom: 1px solid rgba(0, 255, 65, 0.2);">
            <div class="container">
                <div style="text-align: center;">
                    <p style="color: #e0ffe0; margin-bottom: 1rem; font-size: 1.1rem;">
                        <strong>Current Student?</strong> Make your weekly payment here:
                    </p>
                    <a href="dv-weekly-payment.html" class="btn btn-primary" style="font-size: 1.1rem;">
                        💳 Pay Weekly Fee ($30) →
                    </a>
                </div>
            </div>
        </section>

        <!-- Program Info -->
        <section class="program-info" style="padding: 2rem 0; background: rgba(10, 15, 10, 0.5);">
            <div class="container">
                <div class="info-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; max-width: 900px; margin: 0 auto;">
                    <div class="info-card" style="background: rgba(15, 31, 15, 0.8); padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: #10b981; margin-bottom: 0.5rem; font-size: 1.25rem; font-weight: 600;">Program Length</h3>
                        <p style="margin: 0; color: #e0ffe0; font-size: 1rem;">36 weeks</p>
                    </div>
                    <div class="info-card" style="background: rgba(15, 31, 15, 0.8); padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: #10b981; margin-bottom: 0.5rem; font-size: 1.25rem; font-weight: 600;">Class Schedule</h3>
                        <p style="margin: 0; color: #e0ffe0; font-size: 1rem;">To be determined</p>
                    </div>
                    <div class="info-card" style="background: rgba(15, 31, 15, 0.8); padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: #10b981; margin-bottom: 0.5rem; font-size: 1.25rem; font-weight: 600;">Format</h3>
                        <p style="margin: 0; color: #e0ffe0; font-size: 1rem;">In-person only</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Enrollment Form -->
        <section class="contact-form-section">
            <div class="container">
                <div class="form-container">
                    <div class="form-header">
                        <h2>Complete Your Enrollment</h2>
                        <p>Please provide accurate information. All fields marked with * are required. We will contact you within 48 hours to schedule your intake assessment.</p>
                    </div>

                    <form class="contact-form" id="dvEnrollmentForm">
                        <input type="hidden" name="formType" value="dv-classes-enrollment">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="firstName">First Name *</label>
                                <input type="text" id="firstName" name="firstName" required>
                            </div>
                            <div class="form-group">
                                <label for="middleName">Middle Name</label>
                                <input type="text" id="middleName" name="middleName">
                            </div>
                            <div class="form-group">
                                <label for="lastName">Last Name *</label>
                                <input type="text" id="lastName" name="lastName" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="dob">Date of Birth *</label>
                                <input type="date" id="dob" name="dob" required>
                            </div>
                            <div class="form-group">
                                <label for="ssn">Last 4 Digits of SSN *</label>
                                <input type="text" id="ssn" name="ssn" maxlength="4" pattern="[0-9]{4}" required>
                                <small>For identification purposes only</small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="email">Email Address *</label>
                                <input type="email" id="email" name="email" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number *</label>
                                <input type="tel" id="phone" name="phone" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="address">Street Address *</label>
                            <input type="text" id="address" name="address" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="city">City *</label>
                                <input type="text" id="city" name="city" required>
                            </div>
                            <div class="form-group">
                                <label for="state">State *</label>
                                <input type="text" id="state" name="state" value="Nebraska" required>
                            </div>
                            <div class="form-group">
                                <label for="zip">ZIP Code *</label>
                                <input type="text" id="zip" name="zip" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="enrollmentType">Enrollment Type *</label>
                            <select id="enrollmentType" name="enrollmentType" required>
                                <option value="">Please select...</option>
                                <option value="court-ordered">Court-Ordered</option>
                                <option value="probation-required">Probation Required</option>
                                <option value="voluntary">Voluntary</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <div class="form-group" id="courtInfoGroup" style="display: none;">
                            <label for="courtInfo">Court/Case Information</label>
                            <textarea id="courtInfo" name="courtInfo" rows="3" placeholder="Please provide court name, case number, judge name, and any specific requirements from your court order"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="probationOfficer">Probation Officer Name (if applicable)</label>
                            <input type="text" id="probationOfficer" name="probationOfficer">
                        </div>

                        <div class="form-group">
                            <label for="probationContact">Probation Officer Contact</label>
                            <input type="text" id="probationContact" name="probationContact" placeholder="Phone or email">
                        </div>

                        <div class="form-group">
                            <label for="attorney">Attorney Name (if applicable)</label>
                            <input type="text" id="attorney" name="attorney">
                        </div>

                        <div class="form-group">
                            <label for="attorneyContact">Attorney Contact</label>
                            <input type="text" id="attorneyContact" name="attorneyContact" placeholder="Phone or email">
                        </div>

                        <div class="form-group">
                            <label for="preferredSchedule">Preferred Class Schedule *</label>
                            <select id="preferredSchedule" name="preferredSchedule" required>
                                <option value="">Please select...</option>
                                <option value="weekday-evening">Weekday Evening (6:00 PM - 8:00 PM)</option>
                                <option value="saturday-morning">Saturday Morning (9:00 AM - 11:00 AM)</option>
                                <option value="saturday-afternoon">Saturday Afternoon (1:00 PM - 3:00 PM)</option>
                                <option value="flexible">Flexible - Any time works</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="classFormat">Class Format *</label>
                            <select id="classFormat" name="classFormat" required>
                                <option value="in-person">In-Person Only</option>
                            </select>
                            <small>This program is currently offered in-person only</small>
                        </div>

                        <div class="form-group">
                            <label for="employmentStatus">Current Employment Status</label>
                            <select id="employmentStatus" name="employmentStatus">
                                <option value="">Please select...</option>
                                <option value="employed-full">Employed Full-Time</option>
                                <option value="employed-part">Employed Part-Time</option>
                                <option value="self-employed">Self-Employed</option>
                                <option value="unemployed">Unemployed</option>
                                <option value="student">Student</option>
                                <option value="retired">Retired</option>
                                <option value="disabled">Disabled</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="insurance">Do you have health insurance?</label>
                            <select id="insurance" name="insurance">
                                <option value="">Please select...</option>
                                <option value="yes-private">Yes - Private Insurance</option>
                                <option value="yes-medicaid">Yes - Medicaid</option>
                                <option value="yes-medicare">Yes - Medicare</option>
                                <option value="no">No Insurance</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="paymentAbility">Ability to Pay Program Fees</label>
                            <select id="paymentAbility" name="paymentAbility">
                                <option value="">Please select...</option>
                                <option value="full">Can pay full fee</option>
                                <option value="partial">Can pay partial fee</option>
                                <option value="sliding-scale">Need sliding scale</option>
                                <option value="financial-assistance">Need financial assistance</option>
                            </select>
                            <small>We offer sliding scale fees based on income. Financial assistance may be available.</small>
                        </div>

                        <div class="form-group">
                            <label for="priorTreatment">Have you participated in a domestic violence program before?</label>
                            <select id="priorTreatment" name="priorTreatment">
                                <option value="">Please select...</option>
                                <option value="no">No</option>
                                <option value="yes-completed">Yes - Completed</option>
                                <option value="yes-incomplete">Yes - Did not complete</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="substanceUse">Are you currently receiving substance abuse treatment?</label>
                            <select id="substanceUse" name="substanceUse">
                                <option value="">Please select...</option>
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                                <option value="completed">Completed treatment</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="mentalHealth">Are you currently receiving mental health services?</label>
                            <select id="mentalHealth" name="mentalHealth">
                                <option value="">Please select...</option>
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="emergencyContact">Emergency Contact Name *</label>
                            <input type="text" id="emergencyContact" name="emergencyContact" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="emergencyRelationship">Relationship *</label>
                                <input type="text" id="emergencyRelationship" name="emergencyRelationship" required>
                            </div>
                            <div class="form-group">
                                <label for="emergencyPhone">Emergency Contact Phone *</label>
                                <input type="tel" id="emergencyPhone" name="emergencyPhone" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="additionalInfo">Additional Information</label>
                            <textarea id="additionalInfo" name="additionalInfo" rows="4" placeholder="Any other information you'd like us to know (transportation needs, childcare needs, language preferences, accessibility requirements, etc.)"></textarea>
                        </div>

                        <div class="form-group checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="accuracy" name="accuracy" required>
                                I certify that the information provided is accurate and complete *
                            </label>
                        </div>

                        <div class="form-group checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="consent" name="consent" required>
                                I consent to participate in the domestic violence accountability program *
                            </label>
                        </div>

                        <div class="form-group checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="privacy" name="privacy" required>
                                I understand my information will be kept confidential except as required by law or court order *
                            </label>
                        </div>

                        <!-- Payment Section -->
                        <div class="payment-section" style="background: rgba(0, 255, 65, 0.05); padding: 2rem; border-radius: 8px; border: 1px solid rgba(0, 255, 65, 0.2); margin: 2rem 0;">
                            <h3 style="color: #00ff41; margin-bottom: 1rem;">Program Fees</h3>

                            <div class="fee-breakdown" style="background: rgba(15, 31, 15, 0.8); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(0, 255, 65, 0.2);">
                                    <strong style="color: #e0ffe0;">Intake Assessment Fee:</strong>
                                    <span style="color: #00ff41; font-weight: 600;">$35.00</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(0, 255, 65, 0.2);">
                                    <strong style="color: #e0ffe0;">Weekly Class Fee:</strong>
                                    <span style="color: #00ff41; font-weight: 600;">$30.00/week</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <strong style="color: #e0ffe0;">Program Duration:</strong>
                                    <span style="color: #ccffcc;">36 weeks</span>
                                </div>
                            </div>

                            <div class="payment-options">
                                <p style="color: #e0ffe0; margin-bottom: 1rem;">Please select a payment option to complete your enrollment:</p>

                                <div class="form-group">
                                    <label>Payment Option *</label>
                                    <select id="paymentOption" name="paymentOption" required style="font-size: 1rem;">
                                        <option value="">Please select...</option>
                                        <option value="intake-now">Pay Intake Fee Now ($35) - Required to Begin</option>
                                        <option value="intake-later">Pay Intake Fee Later (Call to Schedule Payment)</option>
                                        <option value="weekly-payment">Make a Weekly Payment ($30.00) - Current Students</option>
                                    </select>
                                </div>

                                <div id="paymentNotes" style="display: none; background: rgba(0, 255, 65, 0.1); padding: 1rem; border-radius: 4px; margin-top: 1rem;">
                                    <p id="paymentNoteText" style="margin: 0; color: #ccffcc; font-size: 0.95rem;"></p>
                                </div>

                                <div id="weeklyPaymentInfo" style="display: none; margin-top: 1rem; padding: 1rem; background: rgba(15, 31, 15, 0.6); border-radius: 8px;">
                                    <p style="color: #e0ffe0; margin-bottom: 0.5rem;"><strong>For Weekly Payments:</strong></p>
                                    <p style="color: #ccffcc; font-size: 0.9rem; margin-bottom: 1rem;">Current students - click the button below to make your weekly payment. You can also pay in person or call us at (402) 759-2210.</p>
                                    <a href="dv-weekly-payment.html" class="btn btn-primary" style="display: inline-block; text-decoration: none;">Go to Weekly Payment Page →</a>
                                </div>
                            </div>
                        </div>

                        <div class="form-submit">
                            <button type="button" id="proceedToPayment" class="btn btn-primary btn-large" style="display: none;">Proceed to Payment ($35.00)</button>
                            <button type="submit" id="submitEnrollment" class="btn btn-primary btn-large">Submit Enrollment Application</button>
                            <p class="form-note">We'll contact you within 48 hours to schedule your intake assessment</p>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Aspire Impact Network</h3>
                    <p>Empowering people, elevating business, creating impact in Geneva, Nebraska and beyond.</p>
                    <div class="footer-contact">
                        <p>📞 (402) 759-2210</p>
                        <p>✉️ brandon.hinrichs@aspireimpactnetwork.com</p>
                        <p>📍 Geneva, Nebraska</p>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Justice Support</h4>
                    <ul>
                        <li><a href="justice-support.html">Family Partners</a></li>
                        <li><a href="dv-classes-enrollment.html">Domestic Violence Classes</a></li>
                        <li><a href="justice-support.html">Reentry Support</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Digital Solutions</h4>
                    <ul>
                        <li><a href="digital-solutions.html">Website Management</a></li>
                        <li><a href="digital-solutions.html">SEO Optimization</a></li>
                        <li><a href="digital-solutions.html">Social Media</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Community</h4>
                    <ul>
                        <li><a href="membership.html">Membership Plans</a></li>
                        <li><a href="blog.html">Blog & Resources</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>DV Class Payments</h4>
                    <ul>
                        <li><a href="https://buy.stripe.com/test_4gM9AT57Z1aw3sHaj10RG02" target="_blank">💳 Pay Intake Fee ($35)</a></li>
                        <li><a href="https://buy.stripe.com/test_cNieVdasjaL64wL8aT0RG01" target="_blank">💵 Pay Weekly ($30)</a></li>
                        <li><a href="https://buy.stripe.com/test_14A7sL2ZR8CY1kzcr90RG00" target="_blank">🔄 Auto-Pay Weekly ($30/wk)</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Aspire Impact Network. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://js.stripe.com/v3/"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Initialize Stripe
        const stripe = Stripe('pk_live_51Rcc6ZDN7bYAn961fIpWmQnvdTHeXyWrSyVNGUWtQ3RU4B3sEjq5thzyXNB9NABoZbD8vDPgZUgzLIQ1EZlCzVR200cXmKiJUw');

        // Stripe Payment Links
        const DV_PAYMENT_LINKS = {
            intake: 'https://buy.stripe.com/test_4gM9AT57Z1aw3sHaj10RG02', // Intake fee $35
            weekly: 'https://buy.stripe.com/test_cNieVdasjaL64wL8aT0RG01'  // Weekly payment $30 (non-subscription)
        };

        // Store enrollment data temporarily
        let enrollmentData = null;

        // Show/hide court info based on enrollment type
        document.getElementById('enrollmentType').addEventListener('change', function() {
            const courtInfoGroup = document.getElementById('courtInfoGroup');
            if (this.value === 'court-ordered' || this.value === 'probation-required') {
                courtInfoGroup.style.display = 'block';
                document.getElementById('courtInfo').required = true;
            } else {
                courtInfoGroup.style.display = 'none';
                document.getElementById('courtInfo').required = false;
            }
        });

        // Payment option selection handler
        document.getElementById('paymentOption').addEventListener('change', function() {
            const paymentNotes = document.getElementById('paymentNotes');
            const paymentNoteText = document.getElementById('paymentNoteText');
            const weeklyPaymentInfo = document.getElementById('weeklyPaymentInfo');
            const proceedButton = document.getElementById('proceedToPayment');
            const submitButton = document.getElementById('submitEnrollment');

            paymentNotes.style.display = 'none';
            weeklyPaymentInfo.style.display = 'none';
            proceedButton.style.display = 'none';
            submitButton.style.display = 'inline-block';

            switch(this.value) {
                case 'intake-now':
                    paymentNotes.style.display = 'block';
                    paymentNoteText.textContent = 'After submitting this form, you will be redirected to secure payment processing to pay your $35 intake fee.';
                    proceedButton.style.display = 'inline-block';
                    submitButton.style.display = 'none';
                    break;
                case 'intake-later':
                    paymentNotes.style.display = 'block';
                    paymentNoteText.textContent = 'You can pay your intake fee by calling us at (402) 759-2210 or paying in person. The intake fee must be paid before your first session.';
                    break;
                case 'weekly-payment':
                    weeklyPaymentInfo.style.display = 'block';
                    // Don't show proceed button - they use the link in weeklyPaymentInfo instead
                    break;
            }
        });

        // Proceed to payment button handler
        document.getElementById('proceedToPayment').addEventListener('click', async function() {
            const form = document.getElementById('dvEnrollmentForm');
            const paymentOption = document.getElementById('paymentOption').value;

            // Validate form first
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            // Weekly payment option doesn't use this button anymore
            // Users click the link in weeklyPaymentInfo section

            // For intake payment, save enrollment first, then redirect to payment
            await saveEnrollmentAndPay();
        });

        // Save enrollment and redirect to payment
        async function saveEnrollmentAndPay() {
            const form = document.getElementById('dvEnrollmentForm');
            const submitButton = document.getElementById('proceedToPayment');
            const originalText = submitButton.textContent;

            submitButton.textContent = 'Processing...';
            submitButton.disabled = true;

            try {
                // Initialize Supabase if not already done
                if (!window.supabase) {
                    await initializeSupabase();
                }

                const formData = new FormData(form);
                const data = {
                    firstName: formData.get('firstName'),
                    middleName: formData.get('middleName'),
                    lastName: formData.get('lastName'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    dob: formData.get('dob'),
                    ssn: formData.get('ssn'),
                    address: formData.get('address'),
                    city: formData.get('city'),
                    state: formData.get('state'),
                    zip: formData.get('zip'),
                    enrollmentType: formData.get('enrollmentType'),
                    courtInfo: formData.get('courtInfo'),
                    probationOfficer: formData.get('probationOfficer'),
                    probationContact: formData.get('probationContact'),
                    attorney: formData.get('attorney'),
                    attorneyContact: formData.get('attorneyContact'),
                    preferredSchedule: formData.get('preferredSchedule'),
                    classFormat: formData.get('classFormat'),
                    employmentStatus: formData.get('employmentStatus'),
                    insurance: formData.get('insurance'),
                    paymentAbility: formData.get('paymentAbility'),
                    priorTreatment: formData.get('priorTreatment'),
                    substanceUse: formData.get('substanceUse'),
                    mentalHealth: formData.get('mentalHealth'),
                    emergencyContact: formData.get('emergencyContact'),
                    emergencyRelationship: formData.get('emergencyRelationship'),
                    emergencyPhone: formData.get('emergencyPhone'),
                    additionalInfo: formData.get('additionalInfo'),
                    paymentOption: formData.get('paymentOption')
                };

                // Save to Supabase
                const result = await Database.saveDVEnrollment(data);

                if (!result.success) {
                    throw new Error(result.error);
                }

                // Store enrollment ID in session
                sessionStorage.setItem('dv_enrollment_id', result.data.id);
                sessionStorage.setItem('dv_enrollment_email', data.email);

                // Redirect to Stripe payment
                window.location.href = DV_PAYMENT_LINKS.intake + `?prefilled_email=${encodeURIComponent(data.email)}&client_reference_id=${result.data.id}`;

            } catch (error) {
                console.error('Error submitting DV enrollment:', error);
                alert('There was an error submitting your application. Please try again or call us at (402) 759-2210.');
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            }
        }

        // Regular form submission handler (for non-payment submissions)
        document.getElementById('dvEnrollmentForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const paymentOption = document.getElementById('paymentOption').value;

            // If they selected to pay now or weekly, don't submit via this handler
            if (paymentOption === 'intake-now' || paymentOption === 'weekly-payment') {
                return;
            }

            const submitButton = document.getElementById('submitEnrollment');
            const originalText = submitButton.textContent;

            // Show loading state
            submitButton.textContent = 'Submitting Application...';
            submitButton.disabled = true;

            try {
                // Initialize Supabase if not already done
                if (!window.supabase) {
                    await initializeSupabase();
                }

                const formData = new FormData(this);
                const data = {
                    firstName: formData.get('firstName'),
                    middleName: formData.get('middleName'),
                    lastName: formData.get('lastName'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    dob: formData.get('dob'),
                    ssn: formData.get('ssn'),
                    address: formData.get('address'),
                    city: formData.get('city'),
                    state: formData.get('state'),
                    zip: formData.get('zip'),
                    enrollmentType: formData.get('enrollmentType'),
                    courtInfo: formData.get('courtInfo'),
                    probationOfficer: formData.get('probationOfficer'),
                    probationContact: formData.get('probationContact'),
                    attorney: formData.get('attorney'),
                    attorneyContact: formData.get('attorneyContact'),
                    preferredSchedule: formData.get('preferredSchedule'),
                    classFormat: formData.get('classFormat'),
                    employmentStatus: formData.get('employmentStatus'),
                    insurance: formData.get('insurance'),
                    paymentAbility: formData.get('paymentAbility'),
                    priorTreatment: formData.get('priorTreatment'),
                    substanceUse: formData.get('substanceUse'),
                    mentalHealth: formData.get('mentalHealth'),
                    emergencyContact: formData.get('emergencyContact'),
                    emergencyRelationship: formData.get('emergencyRelationship'),
                    emergencyPhone: formData.get('emergencyPhone'),
                    additionalInfo: formData.get('additionalInfo'),
                    paymentOption: formData.get('paymentOption')
                };

                // Save to Supabase
                const result = await Database.saveDVEnrollment(data);

                if (!result.success) {
                    throw new Error(result.error);
                }

                // Show success message and redirect
                alert('Thank you for your enrollment application. We will contact you within 48 hours to schedule your intake assessment and payment arrangements.');
                window.location.href = 'success.html?type=dv-enrollment';

            } catch (error) {
                console.error('Error submitting DV enrollment:', error);
                alert('There was an error submitting your application. Please try again or call us at (402) 759-2210.');
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            }
        });
    </script>
</body>
</html>